<app-template>

    <!--------------------------------------------------------------------------
    ---                              NAVBAR                                  ---
    --------------------------------------------------------------------------->

    <app-medium-button
        class="navbar-button"
        [routerLink]="['/child-stats']"
        routerLinkActive="active"
    >
        <p class="name">
            <app-user-card [user]="user" class="horizontal navbar"/>
        </p>
    </app-medium-button>

    <app-medium-button
        class="navbar-button"
        [routerLink]="['/child-play']"
        routerLinkActive="active"
    >
        Jouer
    </app-medium-button>

    <app-medium-button
        class="navbar-button"
        [routerLink]="['/child-config']"
        routerLinkActive="active"
    >
        Options
    </app-medium-button>



    <!--------------------------------------------------------------------------
    ---                               MAIN                                   ---
    --------------------------------------------------------------------------->

    <!-- Sections' List : -->
    <app-side-box class="main-box button-list">
        <app-small-button
            [routerLink]="[]"
            [queryParams]="{ 'section': 0 }"
            [class.active]="currSection === 0"
            style="width: 100%;"
        >
            Stats
        </app-small-button>

        <p>HISTORIQUE :</p>

        <app-small-button
            *ngFor="let i of availableHistorySections;"
            [routerLink]="[]"
            [queryParams]="{ 'section': i+1 }"
            [class.active]="currSection === i+1"
            style="width: 100%;"
        >
            {{ getFormattedGameDateByIndex(i, false) }}
        </app-small-button>
    </app-side-box>


    <!-- Invalid Section : -->
    <app-inner-box *ngIf="isInInvalidSection()" class="main-box blue medium">
        <p>Contenu Inexistant</p>
    </app-inner-box>


    <!-- Statistic Section : -->
    <app-inner-box *ngIf="isInStatsSection()" class="main-box blue medium scrollable">
        <h1 class="title">Statistiques générales</h1>

        <ng-container *ngIf="sectionData.playerStats.statistics.globalGrading.grade !== 'XF'; else noStatistics">
            <app-grading-line
                [key]="'Note'"
                [grading]="sectionData.playerStats.statistics.globalGrading"
                [improvement]="sectionData.playerStats.statistics.globalAccuracyImprovement"
            />

            <app-rollable-box
                *ngIf="notionGradings.length > 0"
                [title]="'Détails par notions :'"
            >
                <app-grading-line
                    *ngFor="let n of notionGradings"
                    [key]="n.key"
                    [grading]="n.grading"
                    [improvement]="n.improvement"
                />
            </app-rollable-box>

            <p>
                Mot par minute : {{ sectionData.playerStats.statistics.wordsPerMinute.toFixed(2) }}
                <span
                    *ngIf="user.userConfig.advancedStats && sectionData.playerStats.statistics.wordsPerMinuteImprovement as improvement"
                    [style.color]="improvement > 0 ? 'green' : 'red'"
                >
                    {{ improvement! > 0 ? '+' : '' }}{{ improvement.toFixed(2) }}%
                </span>
            </p>

        </ng-container>

        <ng-template #noStatistics>
            <p>Statistiques Indisponible</p>
            <p>L'utilisateur n'a pas encore été évalué.</p>
        </ng-template>


        <div class="badge-group">
            <h3>Badges acquis :</h3>

            <span class="badge-list">
                <img class="badge" src="../../../../assets/images//icons/crab_killer_trophy.png" alt="Eliminer 200 crabes" title="Eliminer 200 crabes">
                <img class="badge" src="../../../../assets/images//icons/defender_trophy.png" alt="Vous avez atteint un score de plus de 1000 points" title="Vous avez atteint un score de plus de 1000 points">
                <img class="badge" src="../../../../assets/images//icons/zap_trophy.png" alt="Vous êtes sorti de l'état électrique 50 fois" title="Vous êtes sorti de l'état électrique 50 fois">
            </span>
        </div>



    </app-inner-box>

    <app-inner-box *ngIf="isInStatsSection()  && user.userConfig.leaderBoard" class="main-box blue little">
        <h1 class="title">Classement</h1>
        <ng-container *ngIf="sectionData.leaderboard !== undefined; else noLeaderboard">
            <app-user-card
                *ngFor="let lbuserId of sectionData.leaderboard.ranking"
                [userId]="lbuserId"
                class="horizontal"
            />
        </ng-container>

        <ng-template #noLeaderboard>
            <p>Classement Indisponible</p>
        </ng-template>
    </app-inner-box>


    <!-- History Sections : -->
    <app-inner-box *ngIf="isInHistorySections()" class="main-box blue medium scrollable">
        <h1 class="title">Partie du {{ getFormattedGameDate(true) }}</h1>

        <app-grading-line
            [key]="'Note'"
            [grading]="sectionData.playerResults.results.globalGrading"
        />

        <app-rollable-box
            *ngIf="notionGradings.length > 0"
            [title]="'Détails par notions :'"
        >
            <app-grading-line
                *ngFor="let n of notionGradings"
                [key]="n.key"
                [grading]="n.grading"
            />
        </app-rollable-box>

        <p>
            Mot par minute :
            {{ sectionData.playerResults.results.wordsPerMinute.toFixed(2) }}
        </p>

        <div class="badge-group">
            <h3>Récompenses acquises :</h3>

            <span class="badge-list">
                <img class="badge" src="../../../../assets/images//icons/gold_trophy.png" alt="Vous avez eu le score le plus élevé" title="Vous avez eu le score le plus élevé">
                <img class="badge" src="../../../../assets/images//icons/silver_trophy.png" alt="Vous avez eu un très bon score" title="Vous avez eu un très bon score">
                <img class="badge" src="../../../../assets/images//icons/copper_trophy.png" alt="Vous avez fait de votre mieux" title="Vous avez fait de votre mieux et vous êtes récompensés pour ça">
            </span>
        </div>
    </app-inner-box>

    <app-inner-box *ngIf="isInHistorySections() && user.userConfig.leaderBoard" class="main-box blue little">
        <h1 class="title">Classment</h1>
        <ng-container *ngIf="sectionData.leaderboard !== undefined; else noLeaderboard">
            <app-user-card
                *ngFor="let lbuserId of sectionData.leaderboard.ranking"
                [userId]="lbuserId"
                class="horizontal"
            />
        </ng-container>

        <ng-template #noLeaderboard>
            <p>Classement Indisponible</p>
        </ng-template>
    </app-inner-box>

</app-template>